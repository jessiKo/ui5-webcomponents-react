{"version":3,"file":"main.e265c3b6520df1163ca7.bundle.js","sources":["webpack:///./packages/main/src/internal/withWebComponent.tsx","webpack:///./packages/base/src/Device/lib/modernizr.js"],"sourcesContent":["import { Event } from '@ui5/webcomponents-react-base';\nimport React, { Children, cloneElement, Component, CSSProperties, FC, ReactElement } from 'react';\nimport { withTheme } from 'react-jss';\nimport { Fiori3CommonProps } from '../interfaces/Fiori3CommonProps';\nimport { JSSTheme } from '../interfaces/JSSTheme';\nimport { Ui5DomRef } from '../interfaces/Ui5DomRef';\nimport { Ui5WebComponentMetadata } from '../interfaces/Ui5WebComponentMetadata';\n\nfunction capitalizeFirstLetter(s: string) {\n  return s.charAt(0).toUpperCase() + s.slice(1);\n}\n\nfunction toKebabCase(s: string) {\n  return s.replace(/([A-Z])/g, (a, b) => `-${b.toLowerCase()}`);\n}\n\nexport interface WithWebComponentPropTypes extends Fiori3CommonProps {\n  innerComponentRef?: (el: HTMLElement) => void;\n  children?: any | void;\n  innerStyles?: CSSProperties;\n}\n\ninterface WithWebComponentInternalPropTypes extends WithWebComponentPropTypes {\n  theme: JSSTheme;\n}\n\nexport function withWebComponent<T>(WebComponent): FC<T> {\n  class WithWebComponent extends Component<T & WithWebComponentPropTypes> {\n    state = {\n      updateAfterMount: false\n    };\n\n    private wcRef: Ui5DomRef;\n    private shadowRootRef: HTMLElement;\n    private eventRegistry = {};\n    private eventRegistryWrapped = {};\n\n    private handleInnerRef = (ref: HTMLElement) => {\n      const { innerComponentRef } = this.props;\n      this.wcRef = ref;\n      if (innerComponentRef) {\n        innerComponentRef(ref);\n      }\n    };\n\n    private getWebComponentMetadata = (): Ui5WebComponentMetadata => {\n      if (WebComponent) {\n        return WebComponent.getMetadata();\n      }\n\n      return {\n        getProperties() {\n          return {};\n        },\n        getEvents() {\n          return {};\n        },\n        getSlots() {\n          return {};\n        }\n      };\n    };\n\n    private getMetadataBooleans = () => {\n      return Object.entries(this.getWebComponentMetadata().getProperties())\n        .filter(([key, value]) => value.type === Boolean)\n        .map(([key]) => key);\n    };\n\n    private createEventWrapperFor = (eventIdentifier, eventHandler) => (e) => {\n      let payload = Object.keys(this.getWebComponentMetadata().getProperties()).reduce((acc, val) => {\n        if (/^_/.test(val)) {\n          return acc;\n        }\n        acc[val] = e.target[toKebabCase(val)];\n        return acc;\n      }, {});\n\n      payload = Object.keys(this.getWebComponentMetadata().getEvents()[eventIdentifier]).reduce((acc, val) => {\n        if (val === 'detail' && e[val]) {\n          return {\n            ...acc,\n            ...e[val]\n          };\n        }\n        acc[val] = (e.detail && e.detail[val]) || e[val];\n        return acc;\n      }, payload);\n      eventHandler(Event.of(this, e, payload));\n    };\n\n    private bindEvents = () => {\n      this.getMetadataEvents().forEach((eventIdentifier) => {\n        const alternativeKey = 'on' + capitalizeFirstLetter(eventIdentifier);\n        const eventHandler = this.props[eventIdentifier] || this.props[alternativeKey];\n        if (typeof eventHandler === 'function' && this.eventRegistry[alternativeKey] !== eventHandler) {\n          if (this.eventRegistry[alternativeKey]) {\n            this.wcRef.removeEventListener(eventIdentifier, this.eventRegistryWrapped[alternativeKey]);\n          }\n          this.eventRegistryWrapped[alternativeKey] = this.createEventWrapperFor(eventIdentifier, eventHandler);\n          this.wcRef.addEventListener(eventIdentifier, this.eventRegistryWrapped[alternativeKey]);\n          this.eventRegistry[alternativeKey] = eventHandler;\n        } else if (this.eventRegistry[alternativeKey] && !eventHandler) {\n          this.wcRef.removeEventListener(eventIdentifier, this.eventRegistryWrapped[alternativeKey]);\n        }\n      });\n    };\n\n    private getMetadataSlots = () => {\n      return Object.keys(this.getWebComponentMetadata().getSlots());\n    };\n\n    private getMetadataEvents = () => {\n      return Object.keys(this.getWebComponentMetadata().getEvents());\n    };\n\n    get booleanProps() {\n      return this.getMetadataBooleans().reduce((acc, key) => {\n        if (this.props[key]) {\n          acc[toKebabCase(key)] = true;\n        }\n        return acc;\n      }, {});\n    }\n\n    static get propBlacklist() {\n      return {\n        className: true,\n        innerStyles: true\n      };\n    }\n\n    get shadowDomRef() {\n      if (this.shadowRootRef) {\n        return this.shadowRootRef;\n      }\n      return (this.shadowRootRef = this.wcRef && this.wcRef.getDomRef ? this.wcRef.getDomRef() : null);\n    }\n\n    get regularProps() {\n      if (this.wcRef) {\n        this.bindEvents();\n      }\n\n      const props = {};\n      const slotProps = {};\n\n      Object.entries(this.props)\n        .filter(([key]) => !this.getMetadataBooleans().includes(key))\n        .filter(\n          ([key]) =>\n            !this.getMetadataEvents().some(\n              (eventKey) => `on${capitalizeFirstLetter(eventKey)}` === key || key === eventKey\n            )\n        )\n        .filter(([key]) => !WithWebComponent.propBlacklist[key])\n        .forEach(([key, value]) => {\n          if (this.getMetadataSlots().includes(key)) {\n            slotProps[key] = value;\n          } else {\n            props[toKebabCase(key)] = value;\n          }\n        });\n\n      return { props, slotProps };\n    }\n\n    applyInnerStyles = () => {\n      const { innerStyles } = this.props;\n      const shadowRef = this.shadowDomRef;\n      if (!shadowRef) {\n        return;\n      }\n      if (innerStyles) {\n        Object.entries(innerStyles).forEach(([key, value]) => {\n          shadowRef.style[key] = value;\n        });\n      }\n    };\n\n    removeOldStyles = (prevStyles) => {\n      if (prevStyles) {\n        Object.keys(prevStyles).forEach((key) => {\n          this.shadowDomRef.style[key] = '';\n        });\n      }\n    };\n\n    componentDidUpdate(prevProps) {\n      const executionList = [];\n\n      if (prevProps.innerStyles !== this.props.innerStyles) {\n        executionList.push(() => this.removeOldStyles(prevProps.innerStyles));\n        executionList.push(this.applyInnerStyles);\n      }\n\n      if (executionList.length > 0) {\n        requestAnimationFrame(() => {\n          executionList.forEach((exec) => exec());\n        });\n      }\n    }\n\n    componentDidMount() {\n      if (this.wcRef) {\n        this.bindEvents();\n        requestAnimationFrame(() => {\n          this.applyInnerStyles();\n        });\n      } else {\n        this.setState({\n          updateAfterMount: true\n        });\n      }\n    }\n\n    render() {\n      const { className = '' } = this.props;\n\n      const CustomTag = WebComponent.getMetadata().getTag();\n      const slots = WebComponent.getMetadata().getSlots();\n\n      const { props, slotProps } = this.regularProps;\n      const { children, theme, ...regularProps } = props as T & WithWebComponentInternalPropTypes;\n      return (\n        <CustomTag {...this.booleanProps} ref={this.handleInnerRef} {...regularProps} class={className}>\n          {Object.keys(slots).map((slot) => {\n            if (slotProps[slot]) {\n              return Children.map(slotProps[slot], (item: ReactElement<any>, index) =>\n                cloneElement(item, {\n                  key: `${slot}-${index}`,\n                  'data-ui5-slot': slot\n                })\n              );\n            }\n            return null;\n          })}\n          {children}\n        </CustomTag>\n      );\n    }\n  }\n\n  return withTheme(WithWebComponent);\n}\ntry {\n    // @ts-ignore\n    withWebComponent.displayName = \"withWebComponent\";\n    // @ts-ignore\n    withWebComponent.__docgenInfo = { \"description\": \"\", \"displayName\": \"withWebComponent\", \"props\": {} };\n    // @ts-ignore\n    if (typeof STORYBOOK_REACT_CLASSES !== \"undefined\")\n        // @ts-ignore\n        STORYBOOK_REACT_CLASSES[\"packages/main/src/internal/withWebComponent.tsx#withWebComponent\"] = { docgenInfo: withWebComponent.__docgenInfo, name: \"withWebComponent\", path: \"packages/main/src/internal/withWebComponent.tsx#withWebComponent\" };\n}\ncatch (__react_docgen_typescript_loader_error) { }","/*! modernizr 3.6.0 (Custom Build) | MIT *\n * https://modernizr.com/download/?-devicemotion_deviceorientation-matchmedia-placeholder-pointerevents-touchevents-websockets !*/\n!(function(e, t, n) {\n  function r(e, t) {\n    return typeof e === t;\n  }\n  function o() {\n    var e, t, n, o, i, s, a;\n    for (var u in y)\n      if (y.hasOwnProperty(u)) {\n        if (\n          ((e = []),\n          (t = y[u]),\n          t.name && (e.push(t.name.toLowerCase()), t.options && t.options.aliases && t.options.aliases.length))\n        )\n          for (n = 0; n < t.options.aliases.length; n++) e.push(t.options.aliases[n].toLowerCase());\n        for (o = r(t.fn, 'function') ? t.fn() : t.fn, i = 0; i < e.length; i++)\n          (s = e[i]),\n            (a = s.split('.')),\n            1 === a.length\n              ? (Modernizr[a[0]] = o)\n              : (!Modernizr[a[0]] ||\n                  Modernizr[a[0]] instanceof Boolean ||\n                  (Modernizr[a[0]] = new Boolean(Modernizr[a[0]])),\n                (Modernizr[a[0]][a[1]] = o)),\n            C.push((o ? '' : 'no-') + a.join('-'));\n      }\n  }\n  function i() {\n    return 'function' != typeof t.createElement\n      ? t.createElement(arguments[0])\n      : _\n      ? t.createElementNS.call(t, 'http://www.w3.org/2000/svg', arguments[0])\n      : t.createElement.apply(t, arguments);\n  }\n  function s() {\n    var e = t.body;\n    return e || ((e = i(_ ? 'svg' : 'body')), (e.fake = !0)), e;\n  }\n  function a(e, n, r, o) {\n    var a,\n      u,\n      l,\n      f,\n      d = 'modernizr',\n      c = i('div'),\n      p = s();\n    if (parseInt(r, 10)) for (; r--; ) (l = i('div')), (l.id = o ? o[r] : d + (r + 1)), c.appendChild(l);\n    return (\n      (a = i('style')),\n      (a.type = 'text/css'),\n      (a.id = 's' + d),\n      (p.fake ? p : c).appendChild(a),\n      p.appendChild(c),\n      a.styleSheet ? (a.styleSheet.cssText = e) : a.appendChild(t.createTextNode(e)),\n      (c.id = d),\n      p.fake &&\n        ((p.style.background = ''),\n        (p.style.overflow = 'hidden'),\n        (f = x.style.overflow),\n        (x.style.overflow = 'hidden'),\n        x.appendChild(p)),\n      (u = n(c, e)),\n      p.fake ? (p.parentNode.removeChild(p), (x.style.overflow = f), x.offsetHeight) : c.parentNode.removeChild(c),\n      !!u\n    );\n  }\n  function u(e, t) {\n    return !!~('' + e).indexOf(t);\n  }\n  function l(e) {\n    return e\n      .replace(/([A-Z])/g, function(e, t) {\n        return '-' + t.toLowerCase();\n      })\n      .replace(/^ms-/, '-ms-');\n  }\n  function f(t, n, r) {\n    var o;\n    if ('getComputedStyle' in e) {\n      o = getComputedStyle.call(e, t, n);\n      var i = e.console;\n      if (null !== o) r && (o = o.getPropertyValue(r));\n      else if (i) {\n        var s = i.error ? 'error' : 'log';\n        i[s].call(i, 'getComputedStyle returning null, its possible modernizr test results are inaccurate');\n      }\n    } else o = !n && t.currentStyle && t.currentStyle[r];\n    return o;\n  }\n  function d(t, r) {\n    var o = t.length;\n    if ('CSS' in e && 'supports' in e.CSS) {\n      for (; o--; ) if (e.CSS.supports(l(t[o]), r)) return !0;\n      return !1;\n    }\n    if ('CSSSupportsRule' in e) {\n      for (var i = []; o--; ) i.push('(' + l(t[o]) + ':' + r + ')');\n      return (\n        (i = i.join(' or ')),\n        a('@supports (' + i + ') { #modernizr { position: absolute; } }', function(e) {\n          return 'absolute' == f(e, null, 'position');\n        })\n      );\n    }\n    return n;\n  }\n  function c(e) {\n    return e\n      .replace(/([a-z])-([a-z])/g, function(e, t, n) {\n        return t + n.toUpperCase();\n      })\n      .replace(/^-/, '');\n  }\n  function p(e, t, o, s) {\n    function a() {\n      f && (delete L.style, delete L.modElem);\n    }\n    if (((s = r(s, 'undefined') ? !1 : s), !r(o, 'undefined'))) {\n      var l = d(e, o);\n      if (!r(l, 'undefined')) return l;\n    }\n    for (var f, p, v, m, h, y = ['modernizr', 'tspan', 'samp']; !L.style && y.length; )\n      (f = !0), (L.modElem = i(y.shift())), (L.style = L.modElem.style);\n    for (v = e.length, p = 0; v > p; p++)\n      if (((m = e[p]), (h = L.style[m]), u(m, '-') && (m = c(m)), L.style[m] !== n)) {\n        if (s || r(o, 'undefined')) return a(), 'pfx' == t ? m : !0;\n        try {\n          L.style[m] = o;\n        } catch (g) {}\n        if (L.style[m] != h) return a(), 'pfx' == t ? m : !0;\n      }\n    return a(), !1;\n  }\n  function v(e, t) {\n    return function() {\n      return e.apply(t, arguments);\n    };\n  }\n  function m(e, t, n) {\n    var o;\n    for (var i in e) if (e[i] in t) return n === !1 ? e[i] : ((o = t[e[i]]), r(o, 'function') ? v(o, n || t) : o);\n    return !1;\n  }\n  function h(e, t, n, o, i) {\n    var s = e.charAt(0).toUpperCase() + e.slice(1),\n      a = (e + ' ' + P.join(s + ' ') + s).split(' ');\n    return r(t, 'string') || r(t, 'undefined')\n      ? p(a, t, o, i)\n      : ((a = (e + ' ' + w.join(s + ' ') + s).split(' ')), m(a, t, n));\n  }\n  var y = [],\n    g = {\n      _version: '3.6.0',\n      _config: { classPrefix: '', enableClasses: !0, enableJSClass: !0, usePrefixes: !0 },\n      _q: [],\n      on: function(e, t) {\n        var n = this;\n        setTimeout(function() {\n          t(n[e]);\n        }, 0);\n      },\n      addTest: function(e, t, n) {\n        y.push({ name: e, fn: t, options: n });\n      },\n      addAsyncTest: function(e) {\n        y.push({ name: null, fn: e });\n      }\n    },\n    Modernizr = function() {};\n  (Modernizr.prototype = g), (Modernizr = new Modernizr());\n  var C = [],\n    S = 'Moz O ms Webkit',\n    w = g._config.usePrefixes ? S.toLowerCase().split(' ') : [];\n  g._domPrefixes = w;\n  var x = t.documentElement,\n    _ = 'svg' === x.nodeName.toLowerCase(),\n    b = (function() {\n      function e(e, t) {\n        var o;\n        return e\n          ? ((t && 'string' != typeof t) || (t = i(t || 'div')),\n            (e = 'on' + e),\n            (o = e in t),\n            !o &&\n              r &&\n              (t.setAttribute || (t = i('div')),\n              t.setAttribute(e, ''),\n              (o = 'function' == typeof t[e]),\n              t[e] !== n && (t[e] = n),\n              t.removeAttribute(e)),\n            o)\n          : !1;\n      }\n      var r = !('onblur' in t.documentElement);\n      return e;\n    })();\n  (g.hasEvent = b),\n    Modernizr.addTest('pointerevents', function() {\n      var e = !1,\n        t = w.length;\n      for (e = Modernizr.hasEvent('pointerdown'); t-- && !e; ) b(w[t] + 'pointerdown') && (e = !0);\n      return e;\n    });\n  var T = g._config.usePrefixes ? ' -webkit- -moz- -o- -ms- '.split(' ') : ['', ''];\n  g._prefixes = T;\n  var E = (g.testStyles = a);\n  Modernizr.addTest('touchevents', function() {\n    var n;\n    if ('ontouchstart' in e || (e.DocumentTouch && t instanceof DocumentTouch)) n = !0;\n    else {\n      var r = ['@media (', T.join('touch-enabled),('), 'heartz', ')', '{#modernizr{top:9px;position:absolute}}'].join(\n        ''\n      );\n      E(r, function(e) {\n        n = 9 === e.offsetTop;\n      });\n    }\n    return n;\n  });\n  var z = !1;\n  try {\n    z = 'WebSocket' in e && 2 === e.WebSocket.CLOSING;\n  } catch (k) {}\n  Modernizr.addTest('websockets', z),\n    Modernizr.addTest('devicemotion', 'DeviceMotionEvent' in e),\n    Modernizr.addTest('deviceorientation', 'DeviceOrientationEvent' in e),\n    Modernizr.addTest('placeholder', 'placeholder' in i('input') && 'placeholder' in i('textarea'));\n  var P = g._config.usePrefixes ? S.split(' ') : [];\n  g._cssomPrefixes = P;\n  var A = { elem: i('modernizr') };\n  Modernizr._q.push(function() {\n    delete A.elem;\n  });\n  var L = { style: A.elem.style };\n  Modernizr._q.unshift(function() {\n    delete L.style;\n  }),\n    (g.testAllProps = h);\n  var O = function(t) {\n    var r,\n      o = T.length,\n      i = e.CSSRule;\n    if ('undefined' == typeof i) return n;\n    if (!t) return !1;\n    if (((t = t.replace(/^@/, '')), (r = t.replace(/-/g, '_').toUpperCase() + '_RULE'), r in i)) return '@' + t;\n    for (var s = 0; o > s; s++) {\n      var a = T[s],\n        u = a.toUpperCase() + '_' + r;\n      if (u in i) return '@-' + a.toLowerCase() + '-' + t;\n    }\n    return !1;\n  };\n  g.atRule = O;\n  var N = (g.prefixed = function(e, t, n) {\n    return 0 === e.indexOf('@') ? O(e) : (-1 != e.indexOf('-') && (e = c(e)), t ? h(e, t, n) : h(e, 'pfx'));\n  });\n  Modernizr.addTest('matchmedia', !!N('matchMedia', e)), o(), delete g.addTest, delete g.addAsyncTest;\n  for (var j = 0; j < Modernizr._q.length; j++) Modernizr._q[j]();\n  e.Modernizr = Modernizr;\n})(window, document);\n"],"mappings":"AAQA;;ACNA","sourceRoot":""}